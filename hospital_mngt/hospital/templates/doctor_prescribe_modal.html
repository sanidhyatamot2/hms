{% extends "base.html" %}

{% block title %}Prescribe Medicine - {{ patient.Name }}{% endblock %}

{% block content %}
<div class="container my-5">
    <h2 class="text-center fw-bold text-primary mb-4">
        <i class="fas fa-prescription-bottle-alt me-2"></i>Prescribe Medicine for {{ patient.Name }}
    </h2>

    <div class="card shadow-lg">
        <div class="card-body">
            <form method="POST">
                {% csrf_token %}

                <!-- Notes -->
                <div class="mb-4">
                    <label class="form-label fw-bold">Additional Notes (optional)</label>
                    <textarea name="notes" class="form-control" rows="3" placeholder="Special instructions, allergies, etc..."></textarea>
                </div>

                <!-- Dynamic Medicine Rows -->
                <div id="medicineRows">
                    <div class="medicine-row mb-4 border p-3 rounded">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label">Medicine Name</label>
                                <input type="text" name="medicine_name[]" class="form-control" required placeholder="e.g., Paracetamol">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Dosage</label>
                                <input type="text" name="dosage[]" class="form-control" required placeholder="e.g., 500mg, 1 tab 3x/day">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Duration (days)</label>
                                <input type="number" name="duration_days[]" class="form-control" min="1" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Instructions (optional)</label>
                                <input type="text" name="instructions[]" class="form-control" placeholder="After food, etc.">
                            </div>
                            <div class="col-md-1 d-flex align-items-end">
                                <button type="button" class="btn btn-danger btn-sm remove-row">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add More Medicine Button -->
                <button type="button" id="addMedicine" class="btn btn-success mb-4">
                    <i class="fas fa-plus me-1"></i>Add Another Medicine
                </button>

                <!-- Submit -->
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg px-5">
                        <i class="fas fa-save me-1"></i>Issue Prescription
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- JavaScript for Dynamic Rows -->
<script>
document.getElementById('addMedicine').addEventListener('click', function() {
    const container = document.getElementById('medicineRows');
    const row = container.querySelector('.medicine-row').cloneNode(true);
    
    // Clear inputs in new row
    row.querySelectorAll('input').forEach(input => input.value = '');
    
    // Add remove functionality
    row.querySelector('.remove-row').addEventListener('click', function() {
        if (container.querySelectorAll('.medicine-row').length > 1) {
            row.remove();
        }
    });
    
    container.appendChild(row);
});

// Remove row on click (for initial row too)
document.querySelectorAll('.remove-row').forEach(btn => {
    btn.addEventListener('click', function() {
        if (document.querySelectorAll('.medicine-row').length > 1) {
            this.closest('.medicine-row').remove();
        }
    });
});
</script>
{% endblock %}